---
layout: WKWebView
categories: swift
title: WKWebView 制作详情页的一些经验
date: 2016-09-21 03:25:00
tags: [swift,WKWebView]
---

## Hello World

好久好久没有更新过博客了，今天去面试了一家公司。被询问到关于资讯类App的详情页问题，想到了很多之前做详情页时候遇见的问题和解决的问题，所以心血来潮的想记录下来。

{% fi https://drscdn.500px.org/photo/179922657/m%3D900/3c7663bdc0336db0eece19e35d0f118d, 图片, 只有一种英雄主义，就是在认清这个世界之后依然热爱他。 ——罗曼罗兰。 %}

<!-- more -->

## 如何去展示一个详情页呢

那么废话少说，亮剑吧！

### 如何去显示一个WKWebView呢

其实怎么说呢，我觉的其实吧。每个人都大同小异。无非就是如何将数据转换成Html并且将字符串传递给WebView。之后展示出来而已。那么我们很快就会遇到第一个问题。如何将数据转换成Html格式的字符串呢？

#### 搞定我们的模板君

我不清楚其他开发者们遇见的数据结构，但是我的数据结构如下/

````swift
//
//  NewContent.swift
//  Journalism
//
//  Created by Mister on 16/5/30.
//  Copyright © 2016年 aimobier. All rights reserved.
//

import RealmSwift

///  频道的数据模型
open class Content: Object {

    /// 用于获取评论的 docid
    dynamic var txt: String? = nil

    /// 新闻Url
    dynamic var img: String? = nil

    /// 新闻标题
    dynamic var vid: String? = nil
}

///  频道的数据模型
open class NewContent: Object {
    /// 新闻ID
    dynamic var nid = 1
    // 新闻的详情
    let content = List<Content>() // Should be declared with `let`
    // More ……
}
````
详情页对象包含三个字段 `img`,`txt`,`vid`。也就是图片，文字，视频三种类型。
那这样就简单了。把他们拼装成一个Html 还不简单~  

````

String += String // ?????  这样子？  我是拒绝的……

````

之后想起来之前做服务的时候 jsq，ejs… 这些视图模板都是可以完成现在的需求的，不知道IOS 有没有呢？

所以说！  废话！  当然有啊！ [MGTemplateEngine](https://github.com/mattgemmell/MGTemplateEngine)

这就是了~  但是！！！  问题这个大神没有使用那个第三方的管理插件来让别人导入自己的框架~  难道我又要回归到 之前那段 被拖拽引入所支配的恐惧吗？

````
???? 我还是拒绝的~~~
````

那么接下来就有两种方式来引入这个框架了~  当然了 全都是 Cocoapods的……

第一种使用 本地引入的方式：

如果你想本地引入的话，那很简单的

在你的项目根目录下建立一个文件夹 取名字呢~  就叫做 MGTemplateEngine ，之后 把 clone 下来的 MGTemplateEngine 项目放入一个新建的Classes 目录下。之后再classes 同级目录中新建一个 文件 `MGTemplateEngine.podspec`

里面的代码呢，大概写成这样子

````
#
# Be sure to run `pod lib lint SwaggerClient.podspec' to ensure this is a
# valid spec and remove all comments before submitting the spec.
#
# Any lines starting with a # are optional, but encouraged
#
# To learn more about a Podspec see http://guides.cocoapods.org/syntax/podspec.html
#

Pod::Spec.new do |s|
    s.name             = "MGTemplateEngine"
    s.version          = "1.0.0"

    s.summary          = "奇点资讯"
    s.description      = <<-DESC
                        if you～  Shabi Boom Sha Ga la ga
                         DESC

    s.platform     = :ios, '7.0'
    s.requires_arc = true

    s.framework    = 'SystemConfiguration'

    s.homepage     = "https://github.com/swagger-api/swagger-codegen"
    s.license      = "MIT"
    s.source       = { :git => "https://github.com/swagger-api/swagger-codegen.git", :tag => "#{s.version}" }
    s.author       = { "Swagger" => "apiteam@swagger.io" }

    s.source_files = 'Classes/**/*'
    s.public_header_files = 'Classes/**/*.h'
end

````

所有说大概的目录分布呢~  是这个样子的~

````
── 项目根目录
 ├ MGTemplateEngine
 ├──────├ MGTemplateEngine.podspec
 ├──────├ Classes
 │      └──── MGTemplateEngine 所有的文件
 └ 你的其他文件
````

之后呢，在你项目中的Podfile 写下这样的代码~

````
    pod 'MGTemplateEngine', :path => 'MGTemplateEngine/'     ## MGTemplateEngine组件
````

运行完成 pod install~  Woooooo~ 搞定~

第二种呢~~~~
````
    pod 'JMGTemplateEngine'    
````

这个东西是我自己做的为了方便………………

运行完成 pod install~  Woooooo~ 搞定~

#### 显示出来我们的详情吧~

没什么好说的直接上代码吧

````
import MGTemplateEngine

extension MGTemplateEngine{

    static var shareTemplateEngine:MGTemplateEngine!{

        let templateEngine = MGTemplateEngine()

        templateEngine.matcher = ICUTemplateMatcher(templateEngine: templateEngine)

        return templateEngine
    }
}

func getHtmlResourcesString() -> String{

        var body = ""
        let title = "#title{font-size:\(UIFont.a_font9.pointSize)px;}"
        let subtitle = "#subtitle{font-size:\(UIFont.a_font8.pointSize)px;}"
        let bodysection = "#body_section{font-size:\(UIFont.a_font3.pointSize)px;}"

        for conten in self.content{
            if let img = conten.img {
                body += "<img src='\(img)'/>"
            }

            if let vid = conten.vid {
                /// 做了一些视频的处理
                let str = vid.HandleForVideoHtml()

                body += "<div id=\"video\">\(str)</div>"
            }

            if let txt = conten.txt {

                body += "<p>\(txt)</p>"
            }
        }
        let templatePath = Bundle.main.path(forResource: "content_template", ofType: "html")

        let comment = self.comment > 0 ? "   \(self.comment)评" : ""

        let variables = ["title":self.title,"source":self.pname,"ptime":self.ptime,"theme":"normal","body":body,"comment":comment,"titleStyle":title,"subtitleStyle":subtitle,"bodysectionStyle":bodysection]

        let result = MGTemplateEngine.shareTemplateEngine.processTemplateInFile(atPath: templatePath, withVariables: variables)

        return result!
    }
````

我相信所有第一次想使用WebView去展示某些详情页的Developers，遇见的第一个个问题，那就是如何去设置 WKWebView的高度呢？不管你没有反正我是有的。
